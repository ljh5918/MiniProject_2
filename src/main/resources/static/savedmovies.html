<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìˆ˜ì§‘ëœ ì˜í™” ì•„ì¹´ì´ë¸Œ</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
        /* í˜ì´ì§• ë²„íŠ¼ìš© ê°„ë‹¨ ìŠ¤íƒ€ì¼ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }
        .page-btn {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            cursor: pointer;
            border-radius: 5px;
        }
        .page-btn:disabled {
            background-color: #222;
            color: #555;
            cursor: not-allowed;
        }
        .page-info {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .back-link {
            display: block;
            margin: 20px;
            color: #e50914;
            text-decoration: none;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>

    <a href="/" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <h1 style="text-align: center;">ğŸ’¾ MovieSense Archive</h1>
    <p style="text-align: center; color: #ccc;">í˜„ì¬ DBì— ì €ì¥ëœ ëª¨ë“  ì˜í™”ë¥¼ í™•ì¸í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</p>

    <div id="archiveContainer" class="movie-grid" style="padding: 20px;"></div>

    <div class="pagination">
        <button id="prevBtn" class="page-btn" onclick="changePage(-1)">ì´ì „</button>
        <span id="pageInfo" class="page-info">Page 1 / 1</span>
        <button id="nextBtn" class="page-btn" onclick="changePage(1)">ë‹¤ìŒ</button>
    </div>

    <script>
    /* =========================================
    ì „ì—­ ë³€ìˆ˜
    ========================================= */
 const IMAGE_BASE_URL = "https://image.tmdb.org/t/p/w500";
 const NO_POSTER_URL = "https://placehold.co/300x450/000000/ffffff?text=No+Poster";

 let currentPage = 1;
 let totalPages = 1;

 /* =========================================
    ì´ˆê¸°í™”
    ========================================= */
 window.onload = function() {
     fetchMovies(1); // 1í˜ì´ì§€ ë¡œë“œ ì‹œì‘
 };

 /* =========================================
    ë°ì´í„° ë¡œë“œ (í˜ì´ì§•)
    ========================================= */
 function fetchMovies(page) {
     // ë°±ì—”ë“œ API í˜¸ì¶œ
     fetch(`/movies/list?page=${page}`)
         .then(res => res.json())
         .then(data => {
             // Spring Page ê°ì²´ êµ¬ì¡°: { content: [...], totalPages: 5, ... }
             renderMovies(data.content);
             updatePagination(data);
         })
         .catch(err => {
             console.error("ë¡œë”© ì‹¤íŒ¨:", err);
             document.getElementById('archiveContainer').innerHTML = "<p style='text-align:center;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
         });
 }

 /* =========================================
    ë Œë”ë§
    ========================================= */
 function renderMovies(movies) {
     const container = document.getElementById('archiveContainer');
     container.innerHTML = ''; // ì´ˆê¸°í™”

     if (!movies || movies.length === 0) {
         container.innerHTML = "<p style='text-align:center; width:100%;'>ì €ì¥ëœ ì˜í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
         return;
     }

     movies.forEach(movie => {
         const posterSrc = movie.poster_path 
             ? IMAGE_BASE_URL + movie.poster_path 
             : NO_POSTER_URL;

         const card = document.createElement('div');
         card.className = 'movie-card'; 
         // í´ë¦­ ì‹œ ê²½ê³ ì°½ ë„ìš°ê±°ë‚˜, í•„ìš”í•˜ë©´ ë©”ì¸ í˜ì´ì§€ ìƒì„¸ë¡œ ì´ë™í•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥
         card.onclick = () => alert(`ì˜í™” ID: ${movie.id}\nì œëª©: ${movie.title}\n(ìƒì„¸ë³´ê¸°ëŠ” ë©”ì¸ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤)`);
         
         card.innerHTML = `
             <img src="${posterSrc}" alt="${movie.title}">
             <h3>${movie.title}</h3>
             <p style="font-size:0.8rem; color:#aaa;">ID: ${movie.id}</p>
         `;
         container.appendChild(card);
     });
 }

 /* =========================================
    í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
    ========================================= */
 function updatePagination(data) {
     currentPage = data.number + 1; // Springì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
     totalPages = data.totalPages;

     const pageInfo = document.getElementById('pageInfo');
     const prevBtn = document.getElementById('prevBtn');
     const nextBtn = document.getElementById('nextBtn');

     // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
     pageInfo.innerText = `Page ${currentPage} / ${totalPages === 0 ? 1 : totalPages}`;

     // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
     prevBtn.disabled = data.first; // ì²« í˜ì´ì§€ë©´ 'ì´ì „' ë¶ˆê°€
     nextBtn.disabled = data.last;  // ë§ˆì§€ë§‰ í˜ì´ì§€ë©´ 'ë‹¤ìŒ' ë¶ˆê°€
 }

 /* =========================================
    í˜ì´ì§€ ë³€ê²½ ì´ë²¤íŠ¸
    ========================================= */
 function changePage(delta) {
     const newPage = currentPage + delta;
     if (newPage > 0 && newPage <= totalPages) {
         fetchMovies(newPage);
         // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ ì´ë™
         window.scrollTo({ top: 0, behavior: 'smooth' });
     }
 }</script>
</body>
</html>