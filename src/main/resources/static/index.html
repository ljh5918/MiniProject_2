<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MovieSense - ë©”ì¸</title>
    <style>
        #navbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .hide {
            display: none;
        }
    </style>
</head>
<body>
<h1>MovieSense</h1>
<hr>

<!-- ê¸°ë³¸ ë„¤ë¹„ê²Œì´ì…˜ -->
<div id="navbar">
    <a href="/login.html" id="linkLogin">Login</a>
    <a href="/register.html" id="linkRegister">Register</a>

    <span id="userInfo" class="hide">
        <span id="userName"></span> ë‹˜ ì•ˆë…•í•˜ì„¸ìš” |
        <a href="#" id="linkLogout">Logout</a> |
        <a href="/board.html">Board</a>
    </span>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    window.onload = function () {
        checkLoginStatus();

        // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById("linkLogout").onclick = logout;
    }

    // ğŸ”¹ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (JWT ì¿ í‚¤ ê¸°ë°˜)
    async function checkLoginStatus() {
        try {
            const res = await fetch("/auth/me", {
                method: "GET",
                credentials: "include"
            });

            if (!res.ok) {
                showLoggedOutView();
                return;
            }

            const user = await res.json();
            showLoggedInView(user);

        } catch (err) {
            console.error("ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:", err);
            showLoggedOutView();
        }
    }

    // ğŸ”¹ ë¡œê·¸ì¸ëœ í™”ë©´ í‘œì‹œ
    function showLoggedInView(user) {
        document.getElementById("userName").textContent = user.name || user.email;

        // ë¡œê·¸ì¸/íšŒì›ê°€ì… ìˆ¨ê¸°ê¸°
        document.getElementById("linkLogin").classList.add("hide");
        document.getElementById("linkRegister").classList.add("hide");

        // ì‚¬ìš©ì ë©”ë‰´ ë³´ì´ê¸°
        document.getElementById("userInfo").classList.remove("hide");
    }

    // ğŸ”¹ ë¡œê·¸ì¸ ì•ˆëœ í™”ë©´ í‘œì‹œ
    function showLoggedOutView() {
        document.getElementById("linkLogin").classList.remove("hide");
        document.getElementById("linkRegister").classList.remove("hide");

        document.getElementById("userInfo").classList.add("hide");
    }

    // ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
    async function logout() {
        try {
            await fetch("/auth/logout", {
                method: "POST",
                credentials: "include"
            });

            alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤!");
            showLoggedOutView();
        } catch (e) {
            console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", e);
        }
    }
</script>
</body>
</html>
